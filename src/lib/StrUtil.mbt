//æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸ºçº¯æ•°å­—
///|
pub fn is_number(str : String) -> Bool {
  if str.length() == 0 {
    return false
  }
  let mut start = 0
  //å¤„ç†è´Ÿå·
  if str[0] == '-' {
    if str.length() == 1 {
      return false
    }
    start = 1
  }

  //æ£€æŸ¥æ¯ä¸ªå­—ç¬¦
  for i = start; i < str.length(); i = i + 1 {
    if str[i] > '9' || str[i] < '0' {
      return false
    }
  }
  true
}

//éªŒè¯å­—ç¬¦ä¸²æ˜¯å¦å…¨éƒ¨ä¸ºä¸­æ–‡
///|
pub fn is_chinese(str : String) -> Bool {
  if str.length() == 0 {
    return false
  }
  //æ£€æŸ¥æ¯ä¸ªå­—ç¬¦æ˜¯å¦åœ¨ä¸­æ–‡ç¼–ç èŒƒå›´å†…
  //ä¸­æ–‡å­—ç¬¦UnicodeèŒƒå›´ï¼š\u4e00-\u9fa5
  for i = 0; i < str.length(); i = i + 1 {
    let code = str[i].to_int()
    if code < 0x4e00 || code > 0x9fa5 {
      return false
    }
  }
  true
}

// æ£€æŸ¥æ—¥æœŸæ ¼å¼å¯†ç 
///|
pub fn is_valid_date(year : Int, month : Int, day : Int) -> Bool {
  year >= 1950 &&
  year < 2050 &&
  month >= 1 &&
  month <= 12 &&
  day >= 1 &&
  day <= 31
}

///|
pub fn is_all_numeric(s : String) -> Bool {
  for i = 0; i < s.length(); i = i + 1 {
    if s[i] < '0' || s[i] > '9' {
      return false
    }
  }
  true
}

///|
pub fn is_windows_path(str : String) -> Bool {
  if str.length() < 3 {
    return false
  }

  // æ£€æŸ¥ç›˜ç¬¦æ ¼å¼ (X:)
  if ((str[0] >= 'A' && str[0] <= 'Z') || (str[0] >= 'a' && str[0] <= 'z')) ==
    false ||
    str[1] != ':' ||
    (str[2] != '\\' && str[2] != '/') {
    return false
  }

  // æ£€æŸ¥æ˜¯å¦åŒ…å«éæ³•å­—ç¬¦
  let invalid_chars = "<>:\"|?*"
  for i = 3; i < str.length(); i = i + 1 {
    for j = 0; j < invalid_chars.length(); j = j + 1 {
      if str[i] == invalid_chars[j] {
        return false
      }
    }
  }

  // æ£€æŸ¥æ˜¯å¦ä»¥ç‚¹æˆ–ç©ºæ ¼ç»“å°¾
  let last_char = str[str.length() - 1]
  if last_char == '.' || last_char == ' ' {
    return false
  }
  true
}

///|
pub fn is_linux_path(str : String) -> Bool {
  if str.length() == 0 {
    return false
  }

  // æ£€æŸ¥éæ³•å­—ç¬¦
  let invalid_chars = "<>:|\"\\?*"
  for i = 0; i < str.length(); i = i + 1 {
    // æ£€æŸ¥ç©ºæ ¼
    if str[i] == ' ' {
      return false
    }
    // æ£€æŸ¥å…¶ä»–éæ³•å­—ç¬¦
    for j = 0; j < invalid_chars.length(); j = j + 1 {
      if str[i] == invalid_chars[j] {
        return false
      }
    }
  }

  // æ£€æŸ¥è¿ç»­æ–œæ 
  for i = 0; i < str.length() - 1; i = i + 1 {
    if str[i] == '/' && str[i + 1] == '/' {
      return false
    }
  }
  true
}

///|
pub fn to_underline_case(str : String) -> String {
  to_symbol_case(str, '_')
}

///| 
// è½¬æ¢ä¸ºè¿å­—ç¬¦å‘½å
pub fn to_kebab_case(str : String) -> String {
  to_symbol_case(str, '-')
}

///| 
// è½¬æ¢ä¸ºç¬¦å·è¿æ¥çš„å‘½å
pub fn to_symbol_case(str : String, symbol : Char) -> String {
  if str.length() == 0 {
    return ""
  }
  let mut result = ""
  for i = 0; i < str.length(); i = i + 1 {
    let c = str[i]
    if c >= 'A' && c <= 'Z' {
      let prev_char = if i > 0 { str[i - 1] } else { Char::from_int(0) }
      let next_char = if i < str.length() - 1 {
        str[i + 1]
      } else {
        Char::from_int(0)
      }
      if prev_char == symbol {
        // å‰ä¸€ä¸ªä¸ºåˆ†éš”ç¬¦
        if next_char == Char::from_int(0) ||
          (next_char >= 'a' && next_char <= 'z') {
          result = result + c.to_string()
        } else {
          result = result + c.to_string()
        }
      } else if prev_char >= 'a' && prev_char <= 'z' {
        // å‰ä¸€ä¸ªä¸ºå°å†™
        result = result + symbol.to_string() + char_to_lower(c).to_string()
      } else if prev_char >= 'A' && prev_char <= 'Z' {
        // å‰ä¸€ä¸ªä¸ºå¤§å†™
        if next_char >= 'a' && next_char <= 'z' {
          result = result + symbol.to_string() + char_to_lower(c).to_string()
        } else {
          result = result + c.to_string()
        }
        // é¦–å­—æ¯
      } else if next_char == Char::from_int(0) ||
        (next_char >= 'a' && next_char <= 'z') {
        result = result + char_to_lower(c).to_string()
      } else {
        result = result + c.to_string()
      }
    } else {
      result = result + c.to_string()
    }
  }
  result
}

///| 
// è½¬æ¢ä¸ºå¸•æ–¯å¡å‘½åæ³•ï¼ˆé¦–å­—æ¯å¤§å†™çš„é©¼å³°å‘½åï¼‰
pub fn to_pascal_case(str : String) -> String {
  let camel = to_camel_case(str)
  if camel.length() > 0 {
    char_to_upper(camel[0]).to_string() +
    camel.substring(start=1, end=camel.length())
  } else {
    ""
  }
}

///| 
// è½¬æ¢ä¸ºé©¼å³°å‘½åæ³•
pub fn to_camel_case(str : String) -> String {
  to_camel_case_with_symbol(str, '_', true)
}

///| 
// ä½¿ç”¨æŒ‡å®šç¬¦å·è½¬æ¢ä¸ºé©¼å³°å‘½åæ³•
pub fn to_camel_case_with_symbol(
  str : String,
  symbol : Char,
  other_char_to_lower : Bool
) -> String {
  if str.length() == 0 {
    return ""
  }
  let mut result = ""
  let mut upper_case = false
  for i = 0; i < str.length(); i = i + 1 {
    let c = str[i]
    if c == symbol {
      upper_case = true
    } else if upper_case {
      result = result + char_to_upper(c).to_string()
      upper_case = false
    } else {
      result = result +
        (if other_char_to_lower {
          char_to_lower(c).to_string()
        } else {
          c.to_string()
        })
    }
  }
  result
}

///| åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«emojiè¡¨æƒ…
pub fn contains_emoji(str : String) -> Bool {
  if str.length() == 0 {
    return false
  }
  let mut i = 0
  while i < str.length() {
    // è·å–å½“å‰å­—ç¬¦çš„ Unicode ç ç‚¹
    let mut code = str[i].to_int()

    // æ£€æŸ¥æ˜¯å¦åœ¨emojiçš„UnicodeèŒƒå›´å†…
    if (code >= 0x1F300 && code <= 0x1F9FF) || // æ‚é¡¹ç¬¦å·åŠå›¾å½¢
      (code >= 0x2600 && code <= 0x26FF) || // æ‚é¡¹ç¬¦å·
      (code >= 0x2700 && code <= 0x27BF) || // è£…é¥°ç¬¦å·
      (code >= 0x1F600 && code <= 0x1F64F) || // è¡¨æƒ…ç¬¦å·ï¼ˆç¬‘è„¸ç­‰ï¼‰
      (code >= 0xFE00 && code <= 0xFE0F) || // å˜ä½“é€‰æ‹©ç¬¦
      (code >= 0x1F000 && code <= 0x1F02F) || // éº»å°†ç‰Œ
      (code >= 0x1F0A0 && code <= 0x1F0FF) || // æ‰‘å…‹ç‰Œ
      (code >= 0x1F100 && code <= 0x1F1FF) || // å°é—­å¼å­—æ¯æ•°å­—
      (code >= 0x1F200 && code <= 0x1F2FF) || // å°é—­å¼è¡¨æ„æ–‡å­—
      (code >= 0x1F300 && code <= 0x1F9FF) { // å…¶ä»–ç¬¦å·å’Œè±¡å½¢æ–‡å­—
      return true
    }

    // å¤„ç† UTF-16 ä»£ç†å¯¹
    if code >= 0xD800 && code <= 0xDBFF && i + 1 < str.length() {
      let next_code = str[i + 1].to_int()
      if next_code >= 0xDC00 && next_code <= 0xDFFF {
        // åˆå¹¶ä»£ç†å¯¹ä»¥è·å–å®é™…çš„ç ç‚¹
        let high = (code - 0xD800) << 10
        let low = next_code - 0xDC00
        code = high + low + 0x10000
        if code >= 0x1F000 && code <= 0x1F9FF {
          return true
        }
        i = i + 1 // è·³è¿‡ä¸‹ä¸€ä¸ªä»£ç†å­—ç¬¦
      }
    }
    i = i + 1
  }
  false
}


///| è®¡ç®—å­å­—ç¬¦ä¸²åœ¨ä¸»å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°ï¼ˆåŒ…æ‹¬é‡å éƒ¨åˆ†ï¼‰
pub fn count_substring(text : String, sub : String) -> Int {
  if text.length() == 0 || sub.length() == 0 || text.length() < sub.length() {
    return 0
  }
  let mut count = 0
  let mut pos = 0

  // å¾ªç¯æŸ¥æ‰¾å­ä¸²ï¼Œæ¯æ¬¡ä»å½“å‰ä½ç½®çš„ä¸‹ä¸€ä¸ªå­—ç¬¦å¼€å§‹æŸ¥æ‰¾
  while pos <= text.length() - sub.length() {
    let found_pos = text.index_of(sub, from=pos)
    if found_pos == -1 {
      break
    }
    count += 1
    // ä»å½“å‰æ‰¾åˆ°ä½ç½®çš„ä¸‹ä¸€ä¸ªä½ç½®ç»§ç»­æŸ¥æ‰¾ï¼Œè¿™æ ·å¯ä»¥æ‰¾åˆ°é‡å çš„éƒ¨åˆ†
    pos = found_pos + 1
  }
  count
}

///|
test "count_substring" {
  // åŸºæœ¬æµ‹è¯•
  assert_eq!(count_substring("hello hello hello", "hello"), 3)
  assert_eq!(count_substring("aaa", "aa"), 2) // aaa ä¸­ aa å‡ºç°äº†2æ¬¡
  assert_eq!(count_substring("abc abc abc", "abc"), 3)

  // è¾¹ç•Œæµ‹è¯•
  assert_eq!(count_substring("", "test"), 0)
  assert_eq!(count_substring("test", ""), 0)
  assert_eq!(count_substring("a", "aa"), 0)

  // é‡å æµ‹è¯•
  assert_eq!(count_substring("aaaa", "aa"), 3) // aaaa ä¸­ aa å‡ºç°äº†3æ¬¡

  // ç‰¹æ®Šå­—ç¬¦æµ‹è¯•
  assert_eq!(count_substring("ä½ å¥½ä½ å¥½ä½ å¥½", "ä½ å¥½"), 3)
  assert_eq!(count_substring("ğŸ˜ŠğŸ˜ŠğŸ˜Š", "ğŸ˜Š"), 3)

  // æ— åŒ¹é…æµ‹è¯•
  assert_eq!(count_substring("hello world", "xyz"), 0)
}

///|
test "contains_emoji" {
  // æµ‹è¯•çº¯æ–‡æœ¬
  assert_false!(contains_emoji("Hello World"))
  assert_false!(contains_emoji("ä½ å¥½ä¸–ç•Œ"))
  assert_false!(contains_emoji("123456"))

  // æµ‹è¯•å«emojiçš„æ–‡æœ¬
  assert_true!(contains_emoji("HelloğŸ˜Š"))
  assert_true!(contains_emoji("â¤ï¸å¤§"))
  assert_true!(contains_emoji("ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family"))

  // æµ‹è¯•ç‰¹æ®Šæƒ…å†µ
  assert_false!(contains_emoji(""))
  assert_false!(contains_emoji(" "))
  assert_true!(contains_emoji("â¤ï¸"))
  assert_true!(contains_emoji("â˜€ï¸"))
}

///|
///|
test "is_number" {
  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²
  assert_false!(is_number(""))

  // æµ‹è¯•è´Ÿæ•°
  assert_true!(is_number("-123"))
  assert_false!(is_number("-"))

  // æµ‹è¯•æ­£å¸¸æ•°å­—
  assert_true!(is_number("0"))
  assert_true!(is_number("123"))
  assert_true!(is_number("9999"))

  // æµ‹è¯•éæ³•å­—ç¬¦
  assert_false!(is_number("12a3"))
  assert_false!(is_number("1.23"))
  assert_false!(is_number("-12-3"))
}

///|
test "is_chinese" {
  // æµ‹è¯•ç©ºå­—ç¬¦ä¸²
  assert_false!(is_chinese(""))

  // æµ‹è¯•çº¯ä¸­æ–‡
  assert_true!(is_chinese("ä¸­æ–‡"))
  assert_true!(is_chinese("ä½ å¥½ä¸–ç•Œ"))

  // æµ‹è¯•æ··åˆå­—ç¬¦
  assert_false!(is_chinese("ä¸­æ–‡123"))
  assert_false!(is_chinese("Helloä¸­æ–‡"))

  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦
  assert_false!(is_chinese("ä¸­æ–‡ã€‚"))
  assert_false!(is_chinese("ï¼ä¸­æ–‡"))
}

///|
test "windows_path" {
  assert_true!(is_windows_path("C:\\Windows\\System32"))
  assert_true!(is_windows_path("D:/Documents/test.txt"))
  assert_true!(is_windows_path("E:\\Program Files\\App"))
  assert_false!(is_windows_path(""))
  assert_false!(is_windows_path("C:"))
  assert_false!(is_windows_path("1:\\test"))
  assert_false!(is_windows_path("C:\\file?.txt"))
  assert_false!(is_windows_path("C:\\folder\\file."))
}

///|
test "linux_path" {
  assert_true!(is_linux_path("/usr/local/bin"))
  assert_true!(is_linux_path("./config.txt"))
  assert_true!(is_linux_path("../test/file.txt"))
  assert_true!(is_linux_path("/home/user/.bashrc"))
  assert_false!(is_linux_path(""))
  assert_false!(is_linux_path("/test//file"))
  assert_false!(is_linux_path("/usr/local/file?"))
  assert_false!(is_linux_path("/home/user/my file"))
}

///|
test "naming_case" {
  // æµ‹è¯•ä¸‹åˆ’çº¿å‘½å
  assert_eq!(to_underline_case("helloWorld"), "hello_world")
  assert_eq!(to_underline_case("HelloWorld"), "hello_world")
  assert_eq!(to_underline_case("hello_world"), "hello_world")

  // æµ‹è¯•è¿å­—ç¬¦å‘½å
  assert_eq!(to_kebab_case("helloWorld"), "hello-world")
  assert_eq!(to_kebab_case("HelloWorld"), "hello-world")

  // æµ‹è¯•é©¼å³°å‘½å
  assert_eq!(to_camel_case("hello_world"), "helloWorld")

  // æµ‹è¯•å¸•æ–¯å¡å‘½å
  assert_eq!(to_pascal_case("hello_world"), "HelloWorld")
}
